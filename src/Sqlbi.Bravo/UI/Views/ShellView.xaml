<mah:MetroWindow
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        x:Class="Sqlbi.Bravo.UI.Views.ShellView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:app_ui_views="clr-namespace:Sqlbi.Bravo.UI.Views"
        xmlns:app_ui_viewmodels="clr-namespace:Sqlbi.Bravo.UI.ViewModels"
        xmlns:app_ui_framework_valueconverters="clr-namespace:Sqlbi.Bravo.UI.Framework.ValueConverters"
        xmlns:templateSelectors="clr-namespace:Sqlbi.Bravo.UI.Framework.TemplateSelector"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="600"
        Width="850"
        MinWidth="{Binding WindowMinWidth}"
        MinHeight="{Binding WindowMinHeight}"
        WindowStartupLocation="Manual"
        x:Name="window"
        DataContext="{Binding Source={StaticResource ViewModelLocator}, Path=ShellViewModel}">

    <mah:MetroWindow.Resources>
        <ResourceDictionary>

            <DataTemplate x:Key="GlyphMenuItemTemplate" DataType="{x:Type app_ui_viewmodels:NavigationItem}">
                <Grid Height="48">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="48" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Column="0"
                        FontSize="20"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontFamily="Segoe MDL2 Assets"
                        Opacity="{Binding IsEnabled, Converter={app_ui_framework_valueconverters:EnabledOpacityConverter}}"
                        Text="{Binding Glyph}"
                        ToolTip="{Binding Name}" />
                    <TextBlock
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        FontSize="16"
                        Opacity="{Binding IsEnabled, Converter={app_ui_framework_valueconverters:EnabledOpacityConverter}}"
                        Text="{Binding Name}" />
                    <Border Background="Red"
                        Grid.Column="1" CornerRadius="3" Margin="10,0,12,0" Padding="4,0,4,1" Visibility="{Binding ShowComingSoon, Converter={StaticResource BooleanToVisibilityConverter}}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                        <TextBlock Foreground="White" FontSize="12" FontWeight="Bold">SOON</TextBlock>
                    </Border>
                </Grid>
            </DataTemplate>

            <templateSelectors:MenuItemTemplateSelector
                x:Key="MenuItemTemplateSelector"
                GlyphDataTemplate="{StaticResource GlyphMenuItemTemplate}">
                <templateSelectors:MenuItemTemplateSelector.PathDataTemplate>
                    <DataTemplate DataType="{x:Type app_ui_viewmodels:NavigationItem}">
                        <Grid Height="48">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="48" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                FontSize="16"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontFamily="Segoe MDL2 Assets"
                                Opacity="{Binding IsEnabled, Converter={app_ui_framework_valueconverters:EnabledOpacityConverter}}"
                                Text="{Binding Glyph}"
                                ToolTip="{Binding Name}" />
                            <ContentControl Content="{Binding IconControl}" Width="20" Height="20" />
                            <TextBlock
                                Grid.Column="1"
                                VerticalAlignment="Center"
                                FontSize="16"
                                Opacity="{Binding IsEnabled, Converter={app_ui_framework_valueconverters:EnabledOpacityConverter}}"
                                Text="{Binding Name}" />
                            <Border Background="Red"
                                Grid.Column="1" CornerRadius="3" Margin="10,0,12,0" Padding="4,0,4,1" Visibility="{Binding ShowComingSoon, Converter={StaticResource BooleanToVisibilityConverter}}"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center">
                                <TextBlock Foreground="White" FontSize="12" FontWeight="Bold">SOON</TextBlock>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </templateSelectors:MenuItemTemplateSelector.PathDataTemplate>

            </templateSelectors:MenuItemTemplateSelector>

            <Style x:Key="MenuItemsContainer"
                   BasedOn="{StaticResource MahApps.Styles.ListBoxItem.HamburgerMenuItem}"
                   TargetType="{x:Type ListBoxItem}">
                <Setter Property="mah:ItemHelper.ActiveSelectionBackgroundBrush" Value="Transparent" />
                <Setter Property="mah:ItemHelper.ActiveSelectionForegroundBrush" Value="{DynamicResource MahApps.Brushes.AccentBase}" />
                <Setter Property="mah:ItemHelper.HoverBackgroundBrush" Value="{DynamicResource MahApps.Brushes.Gray9}" />
                <Setter Property="mah:ItemHelper.HoverSelectedBackgroundBrush" Value="{DynamicResource MahApps.Brushes.Gray9}" />
                <Setter Property="mah:ItemHelper.HoverSelectedForegroundBrush" Value="{DynamicResource MahApps.Brushes.AccentBase}" />
                <Setter Property="mah:ItemHelper.SelectedBackgroundBrush" Value="Transparent" />
                <Setter Property="mah:ItemHelper.SelectedForegroundBrush" Value="{DynamicResource MahApps.Brushes.AccentBase}" />
            </Style>

            <DataTemplate x:Key="TabItemContentTemplate" DataType="{x:Type app_ui_viewmodels:TabItemViewModel}">
                <Grid>
                    <app_ui_views:DaxFormatterView
                        DataContext="{Binding DaxFormatterVm}"
                        Visibility="{Binding ElementName=window, Path=DataContext.SelectedTab.ShowDaxFormatter, Converter={StaticResource BooleanToVisibilityConverter}}"
                        />
                    <app_ui_views:AnalyzeModelView
                        Visibility="{Binding ShowAnalyzeModel, Converter={StaticResource BooleanToVisibilityConverter}}"
                        />
                    <app_ui_views:SelectConnectionType
                        Visibility="{Binding ShowSelectConnection, Converter={StaticResource BooleanToVisibilityConverter}}"
                        />

                    <Grid Background="{DynamicResource MahApps.Brushes.Control.Background}" Visibility="{Binding ShowError, Converter={StaticResource BooleanToVisibilityConverter}}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Height="200" Stretch="Uniform">
                                <Canvas Width="400" Height="435.92814371257487">
                                    <Canvas >
                                        <Path Fill="{DynamicResource MahApps.Brushes.Text}">
                                            <Path.Data>
                                                <PathGeometry Figures="m 80.496 98.148 -60.308 85.598 v 117.365 117.366 h 124.893 124.893 v -32.164 -32.164 h 53.379 53.379 v -86.912 -86.912 h -99.913 -99.914 l -0.086 -57.438 -0.087 -57.438 -17.793 23.249 -17.793 23.25 -0.171 -49.699 -0.171 -49.698 -60.308 85.597 m 115.57 91.758 h 64.327 v 56.458 56.459 H 145.081 29.769 v -58.13 -58.129 l 50.898 -72.246 50.898 -72.245 0.087 73.916 0.086 73.917 h 64.328 m 87.361 10.235 12.552 9.722 v 5.761 5.762 h -13.002 -13.003 v -15.757 c 0 -12.94 0.081 -15.708 0.451 -15.483 0.248 0.15 6.099 4.648 13.002 9.995 m -144.252 2.879 c -5.437 12.592 -3.581 23.964 5.375 32.93 12.559 12.575 33.418 10.61 43.218 -4.071 1.692 -2.536 4.442 -8.303 4.115 -8.63 -0.171 -0.171 -49.133 -22.102 -50.776 -22.743 -0.655 -0.256 -0.839 -0.016 -1.932 2.514 m 24.891 18.006 c 8.089 3.61 14.787 6.645 14.884 6.745 0.687 0.701 -5.335 4.967 -8.695 6.159 -12.344 4.379 -27.025 -7.419 -24.693 -19.846 l 0.226 -1.205 1.785 0.792 c 0.982 0.436 8.404 3.746 16.493 7.355 m 144.403 -1.515 c 0.941 0.73 1.857 1.45 2.036 1.601 0.178 0.151 -0.784 0.274 -2.139 0.274 h -2.464 v -1.924 c 0 -1.483 0.098 -1.85 0.428 -1.601 0.235 0.178 1.198 0.92 2.139 1.65 m -12.49 27.025 v 15.568 h -13.002 -13.003 v -15.568 -15.569 h 13.003 13.002 v 15.569 m 31.419 -12.404 4.132 3.165 0.018 12.404 0.017 12.403 h -12.831 -12.832 v -15.568 -15.569 h 8.683 8.682 l 4.131 3.165 m 25.138 19.467 c 5.874 4.543 10.745 8.316 10.823 8.383 0.078 0.067 -4.81 0.122 -10.864 0.122 h -11.007 v -8.383 c 0 -4.611 0.083 -8.383 0.184 -8.383 0.1 0 4.989 3.717 10.864 8.261 m -56.557 33.826 v 15.398 h -13.002 -13.003 v -15.398 -15.398 h 13.003 13.002 v 15.398 m 35.586 0 v 15.398 h -12.831 -12.832 v -15.398 -15.398 h 12.832 12.831 v 15.398 m 35.929 0 v 15.398 h -13.003 -13.003 v -15.398 -15.398 h 13.003 13.003 v 15.398 m -107.101 73.396 v 48.075 H 145.081 29.769 v -48.075 -48.075 h 115.312 115.312 v 48.075 m 35.586 -32.164 v 15.911 h -13.002 -13.003 v -15.911 -15.911 h 13.003 13.002 v 15.911 m 35.586 0 v 15.911 h -12.831 -12.832 v -15.911 -15.911 h 12.832 12.831 v 15.911 m 35.929 0 v 15.911 h -13.003 -13.003 v -15.911 -15.911 h 13.003 13.003 v 15.911" FillRule="EvenOdd"/>
                                            </Path.Data>
                                        </Path>
                                    </Canvas>
                                </Canvas>
                            </Viewbox>
                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}">Whoops! Something went wrong...</TextBlock>
                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{Binding ErrorDescription}" />
                            <TextBlock><Hyperlink Style="{StaticResource InlineHyperlinks}" Command="{Binding TryAgainCommand}">Try again</Hyperlink></TextBlock>
                        </StackPanel>
                    </Grid>
                </Grid>
            </DataTemplate>

            <Style x:Key="TabItemHeaderStyle" TargetType="TabItem">
                <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Text}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type TabItem}">
                            <StackPanel x:Name="PART_Content"
                                    HorizontalAlignment="Stretch"
                                    Background="Transparent"
                                    VerticalAlignment="Stretch"
                                    Orientation="Horizontal">
                                <ContentControl
                                    Height="16"
                                    Width="16"
                                    Margin="5,0"
                                    Content="{Binding ConnectionType, Converter={app_ui_framework_valueconverters:ConnectionIconConverter}}" />
                                <TextBlock
                                    x:Name="ContentSite"
                                    Padding="2"
                                    Text="{Binding Header}"
                                    FontSize="12"
                                    VerticalAlignment="Center"/>
                                <Button
                                    x:Name="PART_CloseButton"
                                    VerticalAlignment="Center"
                                    IsTabStop="False"
                                    Cursor="Hand"
                                    Background="Transparent"
                                    Focusable="False"
                                    Margin="10,0,5,0"
                                    Height="16"
                                    Width="18"
                                    BorderThickness="0"
                                    FontSize="8"
                                    FontFamily="Segoe MDL2 Assets"
                                    Content="&#xE106;"
                                    Visibility="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(mah:TabControlHelper.CloseButtonEnabled), Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="Click">
                                            <mah:CloseTabItemAction Command="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(mah:TabControlHelper.CloseTabCommand), Mode=OneWay}" CommandParameter="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(mah:TabControlHelper.CloseTabCommandParameter), Mode=OneWay}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </Button>
                            </StackPanel>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="true">
                                    <Setter TargetName="PART_Content" Property="Background" Value="{DynamicResource MahApps.Brushes.Window.Background}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="mah:TabControlHelper.CloseButtonEnabled" Value="True" />
            </Style>

        </ResourceDictionary>
    </mah:MetroWindow.Resources>
    <mah:MetroWindow.Content>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <mah:HamburgerMenu
                Grid.Row="1"
                x:Name="hamburgerMenu"
                HamburgerButtonName="Open or close menu"
                IsPaneOpen="True"
                DisplayMode="CompactInline"
                ItemCommand="{Binding ItemSelectedCommand}"
                ItemsSource="{Binding MenuItems}"
                ItemContainerStyle="{StaticResource MenuItemsContainer}"
                ItemTemplateSelector="{StaticResource MenuItemTemplateSelector}"
                SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                PaneBackground="{DynamicResource MahApps.Brushes.Gray8}"
                PaneForeground="{DynamicResource MahApps.Brushes.ThemeForeground}"
                OptionsItemCommand="{Binding ItemSelectedCommand}"
                OptionsItemsSource="{Binding OptionMenuItems}"
                OptionsItemTemplate="{StaticResource GlyphMenuItemTemplate}"
                SelectedOptionsItem="{Binding SelectedOptionsItem}"
                ShowSelectionIndicator="True">
                <mah:HamburgerMenu.HamburgerMenuHeaderTemplate>
                    <DataTemplate>
                        <Grid>
                        <Image Height="40" Margin="10" Stretch="uniform" Source="/UI/Resources/Images/logo.png" />

                            <Button Height="30" Width="30"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Padding="0"
                                    VerticalContentAlignment="Center"
                                    HorizontalContentAlignment="Center"
                                    Style="{DynamicResource MahApps.Styles.Button.Flat}"
                                    Click="AddTabClicked">
                                <Button.Resources>
                                    <SolidColorBrush x:Key="MahApps.Brushes.Button.Flat.Background" Color="Transparent" />
                                </Button.Resources>
                                <Button.Content>
                                    <TextBlock FontSize="36" Margin="0,-14,0,0"
                                               FontWeight="Light"
                                               Foreground="{DynamicResource MahApps.Brushes.Text}"
                                               Text="+" />
                                </Button.Content>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </mah:HamburgerMenu.HamburgerMenuHeaderTemplate>

                <mah:HamburgerMenu.Content>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="3*" />
                            <RowDefinition Height="5" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TabControl
                            Grid.Row="0"
                            Background="{DynamicResource MahApps.Brushes.ThemeBackground}"
                            x:Name="TabView"
                            BorderThickness="0"
                            ItemsSource="{Binding Tabs}"
                            TabStripPlacement="Top"
                            ContentTemplate="{StaticResource TabItemContentTemplate}"
                            ItemContainerStyle="{DynamicResource TabItemHeaderStyle}"
                            SelectionChanged="OnSelectedTabChanged"
                            SelectedItem="{Binding SelectedTab, Mode=TwoWay}">
                            <TabControl.Style>
                                <Style TargetType="{x:Type TabControl}">
                                    <Setter Property="Template" >
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type TabControl}">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition x:Name="RowDefinition0" Height="Auto" />
                                                        <RowDefinition x:Name="RowDefinition1" Height="*" />
                                                    </Grid.RowDefinitions>
                                                    <Border x:Name="HeaderPanel"
                                                            Grid.Row="0"
                                                            Background="{DynamicResource MahApps.Brushes.Gray8}"
                                                            BorderThickness="0"
                                                            KeyboardNavigation.DirectionalNavigation="Contained"
                                                            KeyboardNavigation.TabIndex="2"
                                                            KeyboardNavigation.TabNavigation="Local"
                                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                                                            <TabPanel Panel.ZIndex="1"
                                                                  IsItemsHost="true"
                                                                  KeyboardNavigation.TabIndex="1" />
                                                    </Border>
                                                    <Border x:Name="ContentPanel"
                                                            Grid.Row="1"
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="0"
                                                            KeyboardNavigation.DirectionalNavigation="Contained"
                                                            KeyboardNavigation.TabIndex="2"
                                                            KeyboardNavigation.TabNavigation="Local"
                                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                                                        <ContentPresenter x:Name="PART_SelectedContentHost"
                                                                          Margin="0"
                                                                          ContentSource="SelectedContent"
                                                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </Border>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="mah:ScrollViewerHelper.IsHorizontalScrollWheelEnabled" Value="True" />
                                    <Setter Property="mah:TabControlHelper.Transition" Value="Left" />
                                    <Style.Triggers>
                                        <Trigger Property="TabStripPlacement" Value="Top">
                                            <Setter Property="Template" Value="{StaticResource MahApps.Templates.TabControl.AnimatedSingleRow.Horizontal}" />
                                        </Trigger>
                                        <Trigger Property="TabStripPlacement" Value="Bottom">
                                            <Setter Property="Template" Value="{StaticResource MahApps.Templates.TabControl.AnimatedSingleRow.Horizontal}" />
                                        </Trigger>
                                        <Trigger Property="TabStripPlacement" Value="Left">
                                            <Setter Property="Template" Value="{StaticResource MahApps.Templates.TabControl.AnimatedSingleRow.Vertical}" />
                                        </Trigger>
                                        <Trigger Property="TabStripPlacement" Value="Right">
                                            <Setter Property="Template" Value="{StaticResource MahApps.Templates.TabControl.AnimatedSingleRow.Vertical}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TabControl.Style>
                        </TabControl>
                        <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" />
                        <ListBox Grid.Row="2" ItemsSource="{Binding OutputMessages}" />
                    </Grid>
                </mah:HamburgerMenu.Content>
            </mah:HamburgerMenu>
        </Grid>
    </mah:MetroWindow.Content>
</mah:MetroWindow>
