<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?define ProductId = "{3C04D3FA-37F8-4CF2-BF75-BBE6B8CD771B}" ?>
  <?define ProductManufacturer = "SQLBI Corporation" ?>
  <?define ProductVersion = "0.0.1" ?>
  <?define AppUrlInfoAbout = "https://github.com/sql-bi/bravo" ?>
  <?define AppInstallFolder = "SqlbiBravo" ?>
  <?define AppExecutableName = "Bravo.exe" ?>

  <Product Id="$(var.ProductId)" Name="!(loc.ProductName) ($(sys.BUILDARCH))" Language="!(loc.ProductLanguage)" Version="$(var.ProductVersion)" Manufacturer="$(var.ProductManufacturer)" UpgradeCode="{888BDB48-B16A-4D9A-8FE6-0206897B1162}">

    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Manufacturer="$(var.ProductManufacturer)" Description="!(loc.PackageDescription)" Comments="!(loc.PackageComments)" />
    <MajorUpgrade AllowDowngrades="no" DowngradeErrorMessage="!(loc.MajorUpgradeDowngradeErrorMessage)" />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <Feature Id='Complete' Level='1'>
      <ComponentGroupRef Id='AppProductComponentsAutogenerated' />
      <!--ComponentRef Id='AppDesktopShortcut' /-->
      <ComponentRef Id='AppProgramMenuShortcut' />
    </Feature>
    
    <Icon Id="app.ico" SourceFile="$(var.PublishFolder)\$(var.AppExecutableName)" />
    
    <Property Id="ARPPRODUCTICON">app.ico</Property>
    <Property Id="ARPURLINFOABOUT">$(var.AppUrlInfoAbout)</Property>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOX" Value="1"/>
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="!(loc.ExitDialogCheckboxRunApplication)" />
    <Property Id="WixShellExecTarget" Value="[INSTALLFOLDER]$(var.AppExecutableName)" />

    <UI>
      <UIRef Id="WixUI_InstallDir" />
      <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>
    <WixVariable Id="WixUIDialogBmp" Value="assets\background.bmp" />
    <WixVariable Id="WixUIBannerBmp" Value="assets\banner.bmp" />
    <WixVariable Id="WixUILicenseRtf" Value="assets\license.rtf" />
    
    <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
    
  </Product>

  <Fragment>
    
    <Directory Id="TARGETDIR" Name="SourceDir">
      
      <Directory Id="DesktopFolder" Name="Desktop" />
      <Directory Id="ProgramMenuFolder" Name="ProgramMenu" />
      
      <?if $(sys.BUILDARCH)="x64" ?>
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="$(var.AppInstallFolder)" />
      </Directory>
      <?else?>
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="$(var.AppInstallFolder)" />
      </Directory>
      <?endif?>
      
    </Directory>
    
  </Fragment>

  <Fragment>
    
    <DirectoryRef Id="DesktopFolder">
      <!--Component Id="AppDesktopShortcut" Guid="{C341CD4C-61E4-451E-8624-7EC862C1F4A0}">
        <Shortcut Id="AppDesktopShortcut" Name="!(loc.ProductName)" Description="!(loc.ShortcutDescription)" Target="[INSTALLFOLDER]$(var.AppExecutableName)" WorkingDirectory="INSTALLFOLDER" />
        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component-->
    </DirectoryRef>
    
    <DirectoryRef Id="ProgramMenuFolder">
      <Component Id="AppProgramMenuShortcut" Guid="{8C035041-08C9-44CB-B254-D66DA096C53D}">
        <Shortcut Id="AppProgramMenuShortcut" Name="!(loc.ProductName)" Description="!(loc.ShortcutDescription)" Target="[INSTALLFOLDER]$(var.AppExecutableName)" WorkingDirectory="INSTALLFOLDER" />
        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </DirectoryRef>
    
  </Fragment>
  
</Wix>
